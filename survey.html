<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Tretto — Digital Maturity Survey</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="tretto.css" />
  <style>
    /* Survey-specific styles complementing trettocss */
    body {
      background-color: var(--section-bg);
    }

    .survey-header {
      text-align: center;
      padding: 2rem 0;
      background-color: var(--background-color);
      border-bottom: 1px solid rgba(0,0,0,.08);
    }

    .survey-header h1 {
      color: var(--secondary-color);
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      font-size: 1.1rem;
      color: var(--text-color);
      max-width: 600px;
      margin: 0 auto;
    }

    form {
      display: block;
      max-width: 980px;
      margin: 2rem auto;
    }

    fieldset {
      margin: 1.5rem 0;
      border: none;
      background: var(--background-color);
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07);
    }

    legend {
      font-weight: 700;
      font-size: 1.5rem;
      color: var(--secondary-color);
      margin-bottom: 1rem;
      padding: 0;
    }

    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap: 1rem 1.5rem; }
    .grid-3 { display:grid; grid-template-columns: repeat(3, 1fr); gap: 1rem 1.5rem; }
    .row { margin-bottom: 1rem; }
    
    label {
      font-weight: 500;
      display: block;
      margin-bottom: .5rem;
    }

    label.req::after { content:" *"; color: var(--primary-color); }
    .hint { font-size: .9rem; color: #666; margin-bottom: 1rem; }
    
    input[type="text"],
    input[type="email"],
    select,
    textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input[type="text"]:focus,
    input[type="email"]:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
    }

    .error { color: #b00020; font-size: .9rem; margin-top: .25rem; display:none; }
    .has-error .error { display:block; }
    .has-error input, .has-error select { border-color: #b00020; }

    .likert { width:100%; border-collapse: collapse; margin-top:.5rem; }
    .likert th, .likert td { border-bottom:1px solid #eee; padding: .75rem; text-align:center; }
    .likert th { color: var(--secondary-color); font-weight: 500; }
    .likert th:first-child, .likert td:first-child { text-align:left; }
    .likert tr:last-child td { border-bottom: none; }
    .likert input[type="radio"] { transform: scale(1.2); accent-color: var(--primary-color); }

    .stars { display:inline-flex; flex-direction: row-reverse; gap:.25rem; }
    .stars input { display:none; }
    .stars label { cursor:pointer; font-size:1.8rem; line-height:1; color: #ccc; }
    .stars label::before { content:"★"; }
    .stars input:checked ~ label,
    .stars label:hover,
    .stars label:hover ~ label { color: var(--accent-color); }

    .rank-list { list-style:none; padding:0; margin:.5rem 0; border:1px solid #eee; border-radius:8px; }
    .rank-item { padding:.75rem 1rem; background: #fafafa; border-bottom:1px solid #eee; cursor:grab; user-select:none; }
    .rank-item:last-child { border-bottom:none; }
    .rank-item.dragging { opacity:.6; background: var(--accent-color); }

    .actions { display:flex; gap:.75rem; align-items:center; margin-top:1.5rem; }
    
    button, input[type="submit"] {
      background-color: var(--primary-color);
      color: white;
      padding: 0.85rem 1.75rem;
      border-radius: 4px;
      text-decoration: none;
      display: inline-block;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover, input[type="submit"]:hover {
      background-color: #E55A2A; /* Darker shade of primary */
    }
    button[type="button"] {
      background-color: var(--secondary-color);
    }
    button[type="button"]:hover {
      background-color: #1D2A36;
    }

    .score-preview { background: rgba(46, 64, 82, .08); border:1px solid rgba(46, 64, 82, .2); padding:.75rem 1rem; border-radius:8px; display:none; }
    
    footer {
      margin-top: 0; /* Footer from main CSS handles spacing */
    }

    @media (max-width: 720px) {
      .grid-2, .grid-3 { grid-template-columns: 1fr; }
      .likert th, .likert td { font-size:.92rem; padding: 0.5rem 0.25rem; }
      .survey-header h1 { font-size: 2rem; }
    }
  </style>
</head>
<body>
  <header>
    <nav class="container">
        <a href="index.html"><img src="logo.png" alt="Tretto Logo" class="logo"></a>
        <div class="nav-links">
            <a href="https://tretto.io">tretto.io</a>
            <a href="https://tretto.tech">tretto.tech</a>
            <a href="survey.html" class="cta">Digital Maturity Survey</a>
        </div>
    </nav>
  </header>

  <div class="survey-header">
    <h1>Digital Maturity Quick Scan</h1>
    <p class="subtitle">Takes 6–8 minutes. You’ll get 90-day priorities by email.</p>
  </div>

  <div class="container">
    <form id="surveyForm" action="/survey" method="POST" accept-charset="utf-8" novalidate>
      <!-- Hidden fields for server-side processing -->
      <input type="hidden" name="form_id" value="tretto-ctoqs-2025-09" />
      <input type="hidden" name="score_total" id="score_total" />
      <input type="hidden" name="score_tier" id="score_tier" />
      <input type="hidden" name="answers_json" id="answers_json" />

      <!-- About you -->
      <fieldset>
        <legend>About you</legend>
        <div class="grid-2">
          <div class="row">
            <label for="name" class="req">Full name</label>
            <input id="name" name="name" type="text" required />
            <div class="error">Please enter your name.</div>
          </div>
          <div class="row">
            <label for="role" class="req">Role / Job title</label>
            <input id="role" name="role" type="text" required />
            <div class="error">Please enter your role.</div>
          </div>
          <div class="row">
            <label for="company">Company</label>
            <input id="company" name="company" type="text" />
          </div>
          <div class="row">
            <label for="email" class="req">Work email</label>
            <input id="email" name="email" type="email" inputmode="email" required />
            <div class="error">Please enter a valid email.</div>
          </div>
          <div class="row">
            <label for="revband" class="req">Revenue band</label>
            <select id="revband" name="revband" required>
              <option value="">Select…</option>
              <option>€10–25M</option>
              <option>€25–50M</option>
              <option>€50–100M</option>
              <option>€100–250M</option>
              <option>Prefer not to say</option>
            </select>
            <div class="error">Please select a revenue band.</div>
          </div>
          <div class="row">
            <label for="industry" class="req">Industry</label>
            <select id="industry" name="industry" required>
              <option value="">Select…</option>
              <option>Technology</option>
              <option>Financial Services</option>
              <option>Retail/CPG</option>
              <option>Manufacturing</option>
              <option>Healthcare/Life Sciences</option>
              <option>Public Sector</option>
              <option>Other</option>
            </select>
            <div class="error">Please select an industry.</div>
          </div>
        </div>
      </fieldset>

      <!-- Q1 -->
      <fieldset id="q1">
        <legend>Q1 — Governance & ownership</legend>
        <p class="hint">How much of this is in place today?</p>
        <table class="likert" role="table" aria-describedby="q1">
          <thead>
            <tr>
              <th scope="col">Statement</th>
              <th scope="col">Not in place</th>
              <th scope="col">Somewhat</th>
              <th scope="col">Mostly</th>
              <th scope="col">Fully</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Change approvals and roles are clear.</td>
              <td><input type="radio" name="q1_s1" value="1" required></td>
              <td><input type="radio" name="q1_s1" value="2"></td>
              <td><input type="radio" name="q1_s1" value="3"></td>
              <td><input type="radio" name="q1_s1" value="4"></td>
            </tr>
            <tr>
              <td>Owners exist for key data (customer, product).</td>
              <td><input type="radio" name="q1_s2" value="1" required></td>
              <td><input type="radio" name="q1_s2" value="2"></td>
              <td><input type="radio" name="q1_s2" value="3"></td>
              <td><input type="radio" name="q1_s2" value="4"></td>
            </tr>
            <tr>
              <td>Written rules for AI use exist.</td>
              <td><input type="radio" name="q1_s3" value="1" required></td>
              <td><input type="radio" name="q1_s3" value="2"></td>
              <td><input type="radio" name="q1_s3" value="3"></td>
              <td><input type="radio" name="q1_s3" value="4"></td>
            </tr>
            <tr>
              <td>Someone owns privacy/compliance (e.g., DPO/privacy lead).</td>
              <td><input type="radio" name="q1_s4" value="1" required></td>
              <td><input type="radio" name="q1_s4" value="2"></td>
              <td><input type="radio" name="q1_s4" value="3"></td>
              <td><input type="radio" name="q1_s4" value="4"></td>
            </tr>
            <tr>
              <td>Our knowledge base has owners and review dates.</td>
              <td><input type="radio" name="q1_s5" value="1" required></td>
              <td><input type="radio" name="q1_s5" value="2"></td>
              <td><input type="radio" name="q1_s5" value="3"></td>
              <td><input type="radio" name="q1_s5" value="4"></td>
            </tr>
          </tbody>
        </table>
        <div class="error">Please answer all rows in Q1.</div>
      </fieldset>

      <!-- Q2 -->
      <fieldset id="q2">
        <legend>Q2 — Foundations running now</legend>
        <p class="hint">Select all that apply.</p>
        <div class="grid-2">
          <label><input type="checkbox" name="q2[]" value="mdm"> “Single source” of key data (golden record/MDM)</label>
          <label><input type="checkbox" name="q2[]" value="catalog"> Simple data inventory or catalog</label>
          <label><input type="checkbox" name="q2[]" value="rbac"> Role-based access with periodic reviews</label>
          <label><input type="checkbox" name="q2[]" value="eu_resident"> EU-resident hosting option for sensitive data</label>
          <label><input type="checkbox" name="q2[]" value="kb"> Searchable knowledge base (SharePoint/Confluence)</label>
          <label><input type="checkbox" name="q2[]" value="postmortems"> Post-incident reviews and runbooks</label>
          <label><input type="checkbox" name="q2[]" value="ai_guardrails"> Basic AI guardrails (model/prompt review)</label>
          <label><input type="checkbox" name="q2[]" value="none" id="q2_none"> None of the above</label>
        </div>
        <div class="error">Please select at least one option (or “None of the above”).</div>
      </fieldset>

      <!-- Q3 -->
      <fieldset id="q3">
        <legend>Q3 — Can leaders trust what they find?</legend>
        <p class="hint">Confidence that leaders can find, trust, and audit the data/knowledge used for key decisions (incl. AI-assisted).</p>
        <div class="row">
          <input type="range" id="q3_range" name="q3" min="0" max="10" value="5" />
          <output id="q3_out" for="q3_range">5</output>/10
        </div>
      </fieldset>

      <!-- Q4 -->
      <fieldset id="q4">
        <legend>Q4 — Change meets Data & AI</legend>
        <div class="row">
          <label><input type="radio" name="q4" value="fully" required> Fully integrated</label>
        </div>
        <div class="row">
          <label><input type="radio" name="q4" value="partly"> Partly connected</label>
        </div>
        <div class="row">
          <label><input type="radio" name="q4" value="manual"> Manual / depends on team</label>
        </div>
        <div class="row">
          <label><input type="radio" name="q4" value="none"> Not connected / unsure</label>
        </div>
        <div class="error">Please choose one option.</div>
      </fieldset>

      <!-- Q5 -->
      <fieldset id="q5">
        <legend>Q5 — Privacy & data residency outlook</legend>
        <p class="hint">Rate your confidence from 1 to 5 stars.</p>
        <div class="stars" aria-label="Star rating 1 to 5">
          <input type="radio" id="q5_5" name="q5" value="5"><label for="q5_5" title="5 stars"></label>
          <input type="radio" id="q5_4" name="q5" value="4"><label for="q5_4" title="4 stars"></label>
          <input type="radio" id="q5_3" name="q5" value="3"><label for="q5_3" title="3 stars"></label>
          <input type="radio" id="q5_2" name="q5" value="2"><label for="q5_2" title="2 stars"></label>
          <input type="radio" id="q5_1" name="q5" value="1" required><label for="q5_1" title="1 star"></label>
        </div>
        <div class="error">Please select a star rating.</div>
      </fieldset>

      <!-- Q6 -->
      <fieldset id="q6">
        <legend>Q6 — Everyday operations</legend>
        <p class="hint">How consistently do these run in day-to-day operations?</p>
        <table class="likert" role="table" aria-describedby="q6">
          <thead>
            <tr>
              <th>Statement</th>
              <th>Rarely</th>
              <th>Sometimes</th>
              <th>Often</th>
              <th>Always</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Data quality checks on key fields run and alert.</td>
              <td><input type="radio" name="q6_s1" value="1" required></td>
              <td><input type="radio" name="q6_s1" value="2"></td>
              <td><input type="radio" name="q6_s1" value="3"></td>
              <td><input type="radio" name="q6_s1" value="4"></td>
            </tr>
            <tr>
              <td>Releases go smoothly, with rollback plan if needed.</td>
              <td><input type="radio" name="q6_s2" value="1" required></td>
              <td><input type="radio" name="q6_s2" value="2"></td>
              <td><input type="radio" name="q6_s2" value="3"></td>
              <td><input type="radio" name="q6_s2" value="4"></td>
            </tr>
            <tr>
              <td>Knowledge content stays up to date.</td>
              <td><input type="radio" name="q6_s3" value="1" required></td>
              <td><input type="radio" name="q6_s3" value="2"></td>
              <td><input type="radio" name="q6_s3" value="3"></td>
              <td><input type="radio" name="q6_s3" value="4"></td>
            </tr>
            <tr>
              <td>Access reviews happen at least quarterly.</td>
              <td><input type="radio" name="q6_s4" value="1" required></td>
              <td><input type="radio" name="q6_s4" value="2"></td>
              <td><input type="radio" name="q6_s4" value="3"></td>
              <td><input type="radio" name="q6_s4" value="4"></td>
            </tr>
            <tr>
              <td>AI/data pipelines are monitored (freshness, issues).</td>
              <td><input type="radio" name="q6_s5" value="1" required></td>
              <td><input type="radio" name="q6_s5" value="2"></td>
              <td><input type="radio" name="q6_s5" value="3"></td>
              <td><input type="radio" name="q6_s5" value="4"></td>
            </tr>
          </tbody>
        </table>
        <div class="error">Please answer all rows in Q6.</div>
      </fieldset>

      <!-- Q7 -->
      <fieldset id="q7">
        <legend>Q7 — Where are we overall?</legend>
        <div class="row"><label><input type="radio" name="q7" value="basics" required> Getting basics in</label></div>
        <div class="row"><label><input type="radio" name="q7" value="standardizing"> Standardizing</label></div>
        <div class="row"><label><input type="radio" name="q7" value="scaling"> Scaling</label></div>
        <div class="row"><label><input type="radio" name="q7" value="optimizing"> Optimizing</label></div>
        <div class="row"><label><input type="radio" name="q7" value="leading"> Leading for our size</label></div>
        <div class="error">Please choose one option.</div>
      </fieldset>

      <!-- Q8 -->
      <fieldset id="q8">
        <legend>Q8 — Biggest risks right now</legend>
        <p class="hint">Optional, select all that apply.</p>
        <div class="grid-2">
          <label><input type="checkbox" name="q8[]" value="non_eu"> Data stored/processed outside EU or unclear vendor chain</label>
          <label><input type="checkbox" name="q8[]" value="shadow_ai"> Shadow AI/tools moving data off-platform</label>
          <label><input type="checkbox" name="q8[]" value="dq"> Poor data quality in customer/product</label>
          <label><input type="checkbox" name="q8[]" value="findability"> Hard to find “how we do X” or latest template</label>
          <label><input type="checkbox" name="q8[]" value="change"> Slow or risky change approvals</label>
          <label><input type="checkbox" name="q8[]" value="lineage"> No audit trail/lineage for key data</label>
          <label><input type="checkbox" name="q8[]" value="model_risk"> AI risks (wrong answers, bias, IP leakage)</label>
          <label><input type="checkbox" name="q8[]" value="none" id="q8_none"> None of the above</label>
        </div>
      </fieldset>

      <!-- Q9 (Ranking) -->
      <fieldset id="q9">
        <legend>Q9 — 90-day value focus</legend>
        <p class="hint">Optional, drag items to set order (top = most value).</p>
        <ul id="q9_list" class="rank-list">
          <li class="rank-item" draggable="true" data-key="change">Change cadence</li>
          <li class="rank-item" draggable="true" data-key="mdm">Single source of key data</li>
          <li class="rank-item" draggable="true" data-key="privacy">Privacy & vendor contracts</li>
          <li class="rank-item" draggable="true" data-key="knowledge">Knowledge findability</li>
          <li class="rank-item" draggable="true" data-key="ai">AI pilot in production</li>
        </ul>
        <input type="hidden" id="q9_order" name="q9_order" />
      </fieldset>

      <!-- Q10 -->
      <fieldset id="q10">
        <legend>Q10 — One big move (optional)</legend>
        <textarea name="q10" rows="4" placeholder="In one to three sentences, what’s the one decisive move for the next 90 days—and the main blocker?"></textarea>
      </fieldset>

      <div class="actions">
        <button type="submit" id="submitBtn">Calculate & Submit</button>
        <button type="button" id="previewBtn">Preview score</button>
        <div id="scorePreview" class="score-preview" aria-live="polite"></div>
      </div>

      <div style="text-align: center; margin-top: 2rem; font-size: .9rem; color: #666;">
        <p>By submitting, you agree to be contacted by <strong>Tretto</strong> with your results and 90-day priorities.</p>
      </div>
    </form>
  </div>

  <footer>
      <div class="container">
          <p>&copy; 2025 Tretto EU. All rights reserved.</p>
          <div class="nav-links">
              <a href="https://tretto.io">tretto.io</a>
              <a href="https://tretto.tech">tretto.tech</a>
          </div>
      </div>
  </footer>

  <script>
    // Helpers
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    // Range live output
    const q3Range = $('#q3_range'), q3Out = $('#q3_out');
    q3Range.addEventListener('input', () => q3Out.value = q3Range.value);

    // Exclusivity for "None of the above"
    function setupNoneExclusivity(groupName, noneId) {
      const boxes = $$('input[name="'+groupName+'"]');
      const none = $('#'+noneId);
      if (!none) return;
      none.addEventListener('change', () => {
        if (none.checked) boxes.forEach(cb => { if (cb !== none) cb.checked = false; });
      });
      boxes.forEach(cb => {
        if (cb === none) return;
        cb.addEventListener('change', () => { if (cb.checked) none.checked = false; });
      });
    }
    setupNoneExclusivity('q2[]', 'q2_none');
    setupNoneExclusivity('q8[]', 'q8_none');

    // Drag & Drop ranking
    (function setupRanking() {
      const list = $('#q9_list');
      let dragEl = null;
      list.addEventListener('dragstart', e => {
        dragEl = e.target.closest('.rank-item');
        if (!dragEl) return;
        dragEl.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
      });
      list.addEventListener('dragend', e => {
        if (dragEl) dragEl.classList.remove('dragging');
        dragEl = null;
        updateQ9Order();
      });
      list.addEventListener('dragover', e => {
        e.preventDefault();
        const afterEl = getDragAfterElement(list, e.clientY);
        const dragging = $('.rank-item.dragging', list);
        if (!dragging) return;
        if (afterEl == null) list.appendChild(dragging);
        else list.insertBefore(dragging, afterEl);
      });
      function getDragAfterElement(container, y) {
        const els = $$('.rank-item:not(.dragging)', container);
        return els.reduce((closest, child) => {
          const box = child.getBoundingClientRect();
          const offset = y - box.top - box.height / 2;
          if (offset < 0 && offset > closest.offset) {
            return { offset, element: child };
          } else {
            return closest;
          }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
      }
      function updateQ9Order() {
        const order = $$('.rank-item', list).map(li => li.dataset.key);
        $('#q9_order').value = order.join(',');
      }
      updateQ9Order();
    })();

    // Validation
    function showError(fs, msg) {
      fs.classList.add('has-error');
      const err = $('.error', fs);
      if (err) err.textContent = msg;
    }
    function clearErrors() {
      $$('.has-error').forEach(el => el.classList.remove('has-error'));
    }
    function validateRequiredGroup(fsSelector, query) {
      const fs = $(fsSelector);
      const any = $$(query, fs).some(i => i.checked || (i.type === 'range'));
      if (!any) { showError(fs, 'Please complete this question.'); return false; }
      return true;